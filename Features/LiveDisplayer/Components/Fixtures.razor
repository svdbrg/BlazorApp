@using Data
@using Services
@inject IJSRuntime _js

@foreach (var day in days)
{
    <div class="day-wrapper">
        <div class="day">@day.Date</div>
        @foreach (var fixture in day.Fixtures)
        {
            <div class="fixture @HelperMethods.GetCssClassForCurrentStatus(fixture.Status, fixture.Phase)"
        @onmouseout="@(() => removeCurrentlyPlayingDelegate!(fixture.HomeTeamShortName, fixture.AwayTeamShortName))"
        @onmouseover="@(() => setCurrentlyPlayingDelegate!(fixture.HomeTeamShortName, fixture.AwayTeamShortName))">
                <div id="f-@fixture.HomeTeamShortName" class="home">@fixture.HomeTeamShortName</div>
                <div class="result">
                    @(getTimeOrStatus(fixture))
                </div>
                <div id="f-@fixture.AwayTeamShortName" class="away">@fixture.AwayTeamShortName</div>
            </div>
        }

    </div>
}

@code {
    [Parameter]
    public List<Day> days { get; set; } = new();

    [Parameter] public Action<string, string>? setCurrentlyPlayingDelegate { get; set; }

    [Parameter] public Action<string, string>? removeCurrentlyPlayingDelegate { get; set; }

    private string getTimeOrStatus(Fixture fixture)
    {
        if (fixture.Phase == "P")
        {
            return "N/A";
        }

        return fixture.Status == "U" ? fixture.DateAndTime.ToShortTimeString() : fixture.Result;
    }

    public async void setActiveTeam(string team)
    {
        await _js.InvokeVoidAsync($"Fixture.setClass", team);
    }

    public async void removeActiveTeam(string team)
    {
        await _js.InvokeVoidAsync($"Fixture.removeClass", team);
    }
}